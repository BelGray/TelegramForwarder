# Telegram Forwarder (Multi-Session)

Система для автоматической пересылки сообщений из каналов-доноров в целевые чаты.
Реализована на Python с использованием базы данных MySQL для хранения сессий и истории.

Основные функции:
1.  **Мониторинг:** Пересылка новых постов в реальном времени.
2.  **Ротация:** Если аккаунт получает временное ограничение (FloodWait), система автоматически переключается на следующий свободный аккаунт.
3.  **Планировщик:** Автоматическая публикация рекламных постов с удалением предыдущего сообщения.
4.  **Менеджер:** Удобное управление списком каналов через консоль.

---

## 1. Установка

Перед запуском убедитесь, что у вас установлены **Python 3.10+** и **MySQL Server**.

### Шаг 1. Подготовка файлов
Распакуйте архив с проектом в удобную папку.

### Шаг 2. Установка библиотек
Откройте терминал (командную строку) в папке проекта и выполните команду:
```bash
pip install -r requirements.txt
```

### Шаг 3. Настройка Базы Данных
1.  Откройте ваш клиент MySQL (phpMyAdmin, DBeaver или консоль).
2.  Создайте новую базу данных с названием `telegram_forwarder`.
3.  Импортируйте в неё файл `database.sql` (лежит в корне проекта). Это создаст необходимые таблицы.

### Шаг 4. Конфигурация
1.  Найдите файл `.env.example` и переименуйте его в `.env`.
2.  Откройте файл в текстовом редакторе и укажите ваши данные:

```ini
# Данные для подключения к Telegram (получить на my.telegram.org)
API_ID=123456
API_HASH=ваша_хэш_строка

# Данные для подключения к MySQL
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASS=ваш_пароль
DB_NAME=telegram_forwarder
```

---

## 2. Запуск и использование

Система состоит из четырех модулей. Настраивайте их в указанном порядке.

### 1. Добавление аккаунтов (`add_account.py`)
Скрипт для авторизации. Запускайте его каждый раз, когда нужно добавить новый аккаунт в работу.

```bash
python add_account.py
```
*   Введите номер телефона.
*   Введите код подтверждения, который придет в Telegram.
*   Если стоит облачный пароль (2FA), введите его.
*   **Результат:** Сессия сохранится в базу данных. Папка tdata не требуется.

### 2. Настройка каналов (`manager.py`)
Утилита для управления списком источников и получателей.

```bash
python manager.py
```
В меню выберите нужный пункт:
*   **Добавить ИСТОЧНИК:** Ссылка на канал, ОТКУДА нужно пересылать.
*   **Добавить ПОЛУЧАТЕЛЯ:** Ссылка на чат, КУДА нужно пересылать.
*   Также можно просмотреть списки или удалить ненужное.

### 3. Запуск пересылки (`main.py`)
Это основной скрипт. Он должен работать постоянно (на сервере или в фоне).

```bash
python main.py
```
*   Скрипт загрузит аккаунты из базы.
*   Начнет слушать новые сообщения в источниках.
*   При появлении поста — перешлет его во все чаты-получатели.
*   В случае бана или флуда — сменит аккаунт автоматически.

---

## 3. Рекламные инструменты

### Ручная рассылка (`ad_sender.py`)
Используйте, если нужно разово разослать конкретный пост во все чаты.

```bash
python ad_sender.py
```
Скрипт попросит ссылку на сообщение (формат: `https://t.me/channel/123`). Пост будет отправлен во все чаты из базы.

### Авто-планировщик (`scheduler.py`)
Используйте для цикличной публикации рекламы (например, "закреп" раз в час).

```bash
python scheduler.py
```
1.  Введите ссылку на рекламный пост.
2.  Укажите интервал в минутах (например, 60).
3.  **Алгоритм:** Скрипт удалит предыдущее рекламное сообщение (если оно было) и опубликует новое.

---

## Важные примечания

*   **Перезагрузка:** Если вы добавили новые каналы-источники через `manager.py`, перезапустите `main.py`, чтобы изменения вступили в силу. Новые чаты-получатели подхватываются автоматически.
*   **Логи:** Вся информация о работе и ошибках выводится в консоль.
*   **Безопасность:** Файл `.env` содержит ваши пароли. Не передавайте его третьим лицам.