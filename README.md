# Telegram Forwarder Service

Backend-сервис для автоматической пересылки сообщений между Telegram-каналами.
Реализован на Python (Pyrogram) с использованием асинхронной архитектуры и хранением состояния в MySQL.

## Функциональность

*   **Мониторинг:** Отслеживание новых сообщений в каналах-источниках в реальном времени.
*   **Ротация сессий:** Автоматическое переключение на следующий аккаунт при получении `FloodWait` или блокировки.
*   **Дедупликация:** Исключение повторной отправки сообщений (проверка через RAM и БД).
*   **Логирование:** Сохранение истории пересылок и статусов аккаунтов в MySQL.

## Структура проекта

*   `main.py` — Основной сервис пересылки (Daemon).
*   `add_account.py` — Утилита для авторизации новых аккаунтов.
*   `manager.py` — CLI-утилита для управления списком каналов (источники/получатели).
*   `ad_sender.py` — Скрипт для разовой рассылки конкретного сообщения (реклама).

---

## Установка и настройка

### 1. Требования
*   Python 3.10+
*   MySQL Server 8.0+

### 2. Установка зависимостей
Рекомендуется использовать виртуальное окружение.
```bash
pip install -r requirements.txt
```

### 3. Настройка Базы Данных
1.  Создайте базу данных (например, `telegram_forwarder`).
2.  Импортируйте структуру таблиц из файла `database.sql`:
    ```bash
    mysql -u root -p telegram_forwarder < database.sql
    ```

### 4. Конфигурация
Переименуйте файл `.env.example` в `.env` и укажите параметры подключения:

```ini
# Telegram API (my.telegram.org)
API_ID=123456
API_HASH=your_hash_here

# Database Connection
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASS=password
DB_NAME=telegram_forwarder
```

---

## Использование

### 1. Добавление аккаунтов
Для авторизации новой сессии запустите скрипт и следуйте инструкциям (ввод номера и кода подтверждения):
```bash
python add_account.py
```
Сессия будет сохранена в базу данных в зашифрованном виде.

### 2. Управление каналами
Для добавления или удаления источников (откуда пересылать) и получателей (куда пересылать):
```bash
python manager.py
```

### 3. Запуск сервиса
Основной процесс пересылки:
```bash
python main.py
```
*Рекомендуется запускать через systemd или Docker для работы в фоне.*

### 4. Ручная рассылка (Реклама)
Для принудительной пересылки существующего поста во все целевые чаты:
```bash
python ad_sender.py
```
Скрипт запросит ссылку на сообщение формата `https://t.me/channel/123`.

---